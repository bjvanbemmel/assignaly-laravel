#!/bin/bash
cd "$(git rev-parse --show-toplevel)"

npx eslint $(git status --porcelain | awk '$1 != "D" { print $2 }' | awk '/\.js$/ || /\.vue$/ { print $1}') --fix

ESLINT_EXIT="$?"

git add .

if [[ "${ESLINT_EXIT}" == 0 ]]; then
    printf "\n\033[42mCOMMIT SUCCEEDED\033[0m\n"
else
    printf "\n\033[41mCOMMIT FAILED:\033[0m Fix eslint errors and try again\n"
    exit 1
fi

exit $?
